# cc-spec v1.2 - 任务拆分

## 概览

| Wave | Task-ID | 预估 | 状态 | 依赖 |
|------|---------|------|------|------|
| 0 | 34-DOC-SYNC-V11 | 20k | 🟦 空闲 | - |
| 0 | 35-DOC-SYNC-README | 10k | 🟦 空闲 | - |
| 1 | 36-PROFILE-PARSER | 25k | 🟦 空闲 | 34 |
| 1 | 37-CONFIG-AGENTS | 30k | 🟦 空闲 | 34 |
| 1 | 38-APPLY-PROFILE | 20k | 🟦 空闲 | 36, 37 |
| 1 | 39-INIT-AGENTS | 15k | 🟦 空闲 | 37 |
| 2 | 40-CMD-GENERATORS | 35k | 🟦 空闲 | 34 |
| 2 | 41-UPDATE-AGENTS-LIST | 10k | 🟦 空闲 | 40 |
| 3 | 42-UPDATE-TEMPLATES | 25k | 🟦 空闲 | - |
| 3 | 43-GOTO-EXECUTE | 15k | 🟦 空闲 | - |
| 4 | 44-UNIT-TESTS | 30k | 🟦 空闲 | 36-43 |
| 4 | 45-INTEGRATION-TESTS | 25k | 🟦 空闲 | 36-43 |
| 4 | 46-DOCS-UPDATE | 20k | 🟦 空闲 | 36-43 |

**总计**: 13 个任务, 280k tokens 预估

---

## Wave 0: 文档同步

### Task: 34-DOC-SYNC-V11
**预估上下文**: ~20k tokens
**状态**: 🟦 空闲
**依赖**: 无

**目标**: 更新 v1.1 任务拆分文档，使其与实际代码状态一致

**必读文档**:
- `docs/plan/cc-spec-v1.1/05-任务拆分.md`
- `docs/plan/cc-spec-v1.2/02-现状分析.md`

**核心代码入口**:
- `src/cc_spec/core/id_manager.py`
- `src/cc_spec/commands/list.py`
- `src/cc_spec/commands/goto.py`
- `src/cc_spec/commands/update.py`

**Checklist**:
- [ ] 读取 v1.1 任务拆分文档
- [ ] 对照代码实现确认每个任务状态
- [ ] 将任务 20-29 状态更新为 🟩 完成
- [ ] 将任务 30-31 状态更新为 🟨 部分完成
- [ ] 将任务 32 状态更新为 ✅ 完成
- [ ] 将任务 33 状态更新为 🟦 空闲（文档未更新）
- [ ] 为每个完成任务添加简要说明

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 35-DOC-SYNC-README
**预估上下文**: ~10k tokens
**状态**: 🟦 空闲
**依赖**: 无

**目标**: 更新 v1.1 概览文档，标记为已完成

**必读文档**:
- `docs/plan/cc-spec-v1.1/README.md`
- `docs/plan/cc-spec-v1.1/CONTINUE.md`

**Checklist**:
- [ ] 更新 README.md 状态汇总为"已完成"
- [ ] 添加完成日期
- [ ] 添加链接到 v1.2 规划
- [ ] 更新 CONTINUE.md 标记为已完成

**执行日志**:
_(SubAgent 执行时填写)_

---

## Wave 1: 核心功能

### Task: 36-PROFILE-PARSER
**预估上下文**: ~25k tokens
**状态**: 🟦 空闲
**依赖**: 34-DOC-SYNC-V11

**目标**: 在 task_parser 中添加 Profile 字段解析支持

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (2.1 节)

**核心代码入口**:
- `src/cc_spec/subagent/task_parser.py`

**Checklist**:
- [ ] 在 TaskInfo dataclass 添加 `profile: str | None = None`
- [ ] 在 `_parse_task_section()` 添加 Profile 正则匹配
- [ ] 解析 `**Profile**: quick` 格式
- [ ] 无 Profile 时设为 None（向后兼容）
- [ ] 编写单元测试 `tests/test_task_parser.py`
- [ ] 测试有 Profile 的解析
- [ ] 测试无 Profile 的解析
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 37-CONFIG-AGENTS
**预估上下文**: ~30k tokens
**状态**: 🟦 空闲
**依赖**: 34-DOC-SYNC-V11

**目标**: 在 Config 中添加 agents 多工具配置支持

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (2.2 节)

**核心代码入口**:
- `src/cc_spec/core/config.py`

**Checklist**:
- [ ] 创建 AgentsConfig dataclass
  - enabled: list[str]
  - default: str
- [ ] 在 Config 添加 agents 字段
- [ ] 更新 version 默认值为 "1.2"
- [ ] 添加 get_active_agent() 方法
- [ ] 实现 load_config 迁移逻辑
  - 检测旧格式
  - 自动转换 agent -> agents
- [ ] 保留 agent 字段向后兼容
- [ ] 编写测试 `tests/test_config.py`
- [ ] 测试新格式加载
- [ ] 测试旧格式迁移
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 38-APPLY-PROFILE
**预估上下文**: ~20k tokens
**状态**: 🟦 空闲
**依赖**: 36-PROFILE-PARSER, 37-CONFIG-AGENTS

**目标**: apply 命令集成 Profile 配置选择

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (2.1.4 节)

**核心代码入口**:
- `src/cc_spec/commands/apply.py`
- `src/cc_spec/subagent/executor.py`

**Checklist**:
- [ ] 在 apply 执行任务时读取 task.profile
- [ ] 调用 config.subagent.get_profile(profile_name)
- [ ] 使用返回的配置参数执行
- [ ] 无 Profile 时使用 "common" 配置
- [ ] 编写测试验证 Profile 选择逻辑
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 39-INIT-AGENTS
**预估上下文**: ~15k tokens
**状态**: 🟦 空闲
**依赖**: 37-CONFIG-AGENTS

**目标**: init 命令支持 agents 配置生成

**核心代码入口**:
- `src/cc_spec/commands/init.py`

**Checklist**:
- [ ] 更新 --ai 参数处理逻辑
- [ ] 生成 agents.enabled 列表
- [ ] 设置 agents.default 为第一个工具
- [ ] 生成配置文件包含 agents 字段
- [ ] 编写测试
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

## Wave 2: 工具扩展

### Task: 40-CMD-GENERATORS
**预估上下文**: ~35k tokens
**状态**: 🟦 空闲
**依赖**: 34-DOC-SYNC-V11

**目标**: 补全命令生成器至 17+ 工具

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (2.3 节)

**核心代码入口**:
- `src/cc_spec/core/command_generator.py`

**Checklist**:
- [ ] 添加 TabnineCommandGenerator
  - 目录: `.tabnine/commands`
- [ ] 添加 AiderCommandGenerator
  - 目录: `.aider/commands`
- [ ] 添加 DevinCommandGenerator
  - 目录: `.devin/commands`
- [ ] 添加 ReplitCommandGenerator
  - 目录: `.replit/commands`
- [ ] 添加 CodyCommandGenerator
  - 目录: `.cody/commands`
- [ ] 添加 SupermavenCommandGenerator
  - 目录: `.supermaven/commands`
- [ ] 添加 KiloCodeCommandGenerator
  - 目录: `.kilo/commands`
- [ ] 添加 AuggieCommandGenerator
  - 目录: `.auggie/commands`
- [ ] 更新 COMMAND_GENERATORS 注册表
- [ ] 编写测试验证新生成器
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 41-UPDATE-AGENTS-LIST
**预估上下文**: ~10k tokens
**状态**: 🟦 空闲
**依赖**: 40-CMD-GENERATORS

**目标**: 更新 update 命令的工具列表

**核心代码入口**:
- `src/cc_spec/commands/update.py`

**Checklist**:
- [ ] 更新 AVAILABLE_AGENTS 列表
- [ ] 添加新工具名称（与生成器一致）
- [ ] 验证 `cc-spec update agents` 显示完整列表
- [ ] 编写测试
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

## Wave 3: 增强功能

### Task: 42-UPDATE-TEMPLATES
**预估上下文**: ~25k tokens
**状态**: 🟦 空闲
**依赖**: 无

**目标**: 实现 update --templates 真实下载功能

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (3.1 节)

**核心代码入口**:
- `src/cc_spec/commands/update.py`
- `src/cc_spec/utils/download.py` (如需新建)

**Checklist**:
- [ ] 确定模板托管方案
  - GitHub raw 文件 / 本地 fallback
- [ ] 定义 TEMPLATE_BASE_URL 常量
- [ ] 定义 TEMPLATE_FILES 列表
- [ ] 实现 `_update_templates()` 下载逻辑
- [ ] 添加网络错误处理
- [ ] 添加 force 参数强制覆盖
- [ ] 编写测试（mock 网络）
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 43-GOTO-EXECUTE
**预估上下文**: ~15k tokens
**状态**: 🟦 空闲
**依赖**: 无

**目标**: goto 命令添加 --execute 自动执行选项

**必读文档**:
- `docs/plan/cc-spec-v1.2/03-设计方案.md` (3.2 节)

**核心代码入口**:
- `src/cc_spec/commands/goto.py`

**Checklist**:
- [ ] 添加 --execute / -x 选项
- [ ] 实现 subprocess 调用执行命令
- [ ] 显示执行输出
- [ ] 处理执行错误
- [ ] 默认行为保持不变（只打印）
- [ ] 编写测试
- [ ] 运行测试确保通过

**执行日志**:
_(SubAgent 执行时填写)_

---

## Wave 4: 测试文档

### Task: 44-UNIT-TESTS
**预估上下文**: ~30k tokens
**状态**: 🟦 空闲
**依赖**: 36-43 (所有功能任务)

**目标**: 补全单元测试覆盖

**核心代码入口**:
- `tests/test_task_parser.py`
- `tests/test_config.py`
- `tests/test_command_generator.py`
- `tests/test_cmd_update.py`

**Checklist**:
- [ ] 验证 Profile 解析测试完整
- [ ] 验证 agents 配置测试完整
- [ ] 验证命令生成器测试完整
- [ ] 验证 update 命令测试完整
- [ ] 运行 `pytest tests/ -v` 全部通过
- [ ] 检查覆盖率 >= 80%

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 45-INTEGRATION-TESTS
**预估上下文**: ~25k tokens
**状态**: 🟦 空闲
**依赖**: 36-43 (所有功能任务)

**目标**: 增强集成测试覆盖

**核心代码入口**:
- `tests/integration/test_v11_workflow.py`
- `tests/integration/test_v12_workflow.py` (新建)

**Checklist**:
- [ ] 更新 v1.1 工作流测试
- [ ] 创建 v1.2 工作流测试文件
- [ ] 添加 Profile 执行流程测试
- [ ] 添加多工具初始化测试
- [ ] 添加配置迁移测试
- [ ] 运行集成测试全部通过

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 46-DOCS-UPDATE
**预估上下文**: ~20k tokens
**状态**: 🟦 空闲
**依赖**: 36-43 (所有功能任务)

**目标**: 更新用户文档

**核心代码入口**:
- `docs/cc-spec/commands.md`
- `README.md`
- `CHANGELOG.md` (如需新建)

**Checklist**:
- [ ] 更新 commands.md
  - 添加 Profile 使用说明
  - 更新 agents 配置说明
  - 更新 update --templates 说明
  - 更新 goto --execute 说明
- [ ] 更新 README.md
  - 版本信息改为 v1.2
  - 新功能概览
- [ ] 创建/更新 CHANGELOG.md
  - 记录 v1.2 变更
- [ ] 检查文档与代码一致

**执行日志**:
_(SubAgent 执行时填写)_

---

## 状态图例

| 图标 | 状态 | 说明 |
|------|------|------|
| 🟦 | 空闲 | 任务未开始 |
| 🟨 | 进行中 | 任务执行中 |
| 🟩 | 完成 | 任务已完成 |
| 🟥 | 失败 | 任务执行失败 |
| ⏰ | 超时 | 任务执行超时 |

## 执行说明

1. **Wave 执行顺序**: Wave 0 → Wave 1 → Wave 2 → Wave 3 → Wave 4
2. **并行执行**: 同一 Wave 内的任务可并行执行
3. **依赖检查**: 开始任务前确保依赖任务已完成
4. **状态更新**: 完成任务后及时更新状态

## Token 预估说明

- 预估基于任务复杂度和代码量
- 实际消耗可能因代码探索深度而异
- 总预估 280k tokens，建议预留 20% 余量
