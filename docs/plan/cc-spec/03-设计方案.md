# 03 - è®¾è®¡æ–¹æ¡ˆ

## CLI å‘½ä»¤è®¾è®¡

### å‘½ä»¤ä¸€è§ˆ

```
cc-spec init [project]      # åˆå§‹åŒ–ï¼Œä¸‹è½½æ¨¡æ¿åˆ° .cc-spec/
cc-spec specify             # ç¼–å†™éœ€æ±‚è§„æ ¼
cc-spec clarify             # æ¾„æ¸…éœ€æ±‚ï¼ˆåˆ—è¡¨ + è¯¦æƒ…ï¼‰
cc-spec plan                # ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
cc-spec apply               # SubAgent å¹¶å‘æ‰§è¡Œ
cc-spec checklist           # éªŒæ”¶æ‰“åˆ†
cc-spec archive             # å½’æ¡£å˜æ›´
cc-spec quick-delta         # è¶…ç®€å•æ¨¡å¼ï¼šä¸€æ­¥ç”Ÿæˆå˜æ›´è®°å½•
```

### å‘½ä»¤è¯¦ç»†è®¾è®¡

#### `cc-spec init`

```python
@app.command()
def init(
    project: str = typer.Argument(None, help="é¡¹ç›®åç§°"),
    agent: str = typer.Option(None, help="AI å·¥å…·ç±»å‹"),
    force: bool = typer.Option(False, help="å¼ºåˆ¶è¦†ç›–")
):
    """åˆå§‹åŒ– cc-spec å·¥ä½œæµç›®å½•"""
    # 1. åˆ›å»º .cc-spec/ ç›®å½•
    # 2. ä¸‹è½½æ¨¡æ¿æ–‡ä»¶åˆ° .cc-spec/templates/
    # 3. åˆ›å»ºç©ºçš„ changes/ ç›®å½•
    # 4. æ£€æµ‹æˆ–è¯¢é—® AI å·¥å…·ç±»å‹
```

**äº§å‡ºæ–‡ä»¶**:
```
.cc-spec/
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ spec-template.md
â”‚   â”œâ”€â”€ plan-template.md
â”‚   â”œâ”€â”€ tasks-template.md
â”‚   â””â”€â”€ checklist-template.md
â”œâ”€â”€ changes/
â”‚   â””â”€â”€ (ç©ºï¼Œå¾… specify åˆ›å»º)
â””â”€â”€ config.yaml
```

#### `cc-spec specify`

```python
@app.command()
def specify(
    name: str = typer.Argument(..., help="å˜æ›´åç§°"),
    template: str = typer.Option("default", help="æ¨¡æ¿ç±»å‹")
):
    """åˆ›å»ºæ–°çš„å˜æ›´è§„æ ¼"""
    # 1. åˆ›å»º .cc-spec/changes/{name}/
    # 2. å¤åˆ¶æ¨¡æ¿ç”Ÿæˆ proposal.md
    # 3. æç¤ºç”¨æˆ·å¡«å†™éœ€æ±‚
```

**äº§å‡ºæ–‡ä»¶**:
```
.cc-spec/changes/{name}/
â”œâ”€â”€ proposal.md      # Why + What Changes + Impact
â””â”€â”€ status.yaml      # çŠ¶æ€è·Ÿè¸ª
```

#### `cc-spec clarify`

```python
@app.command()
def clarify(
    task_id: str = typer.Argument(None, help="ä»»åŠ¡ IDï¼ˆå¯é€‰ï¼‰")
):
    """æ¾„æ¸…éœ€æ±‚æˆ–è¿”å·¥æŒ‡å®šä»»åŠ¡"""
    if task_id is None:
        # clarify list: æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çŠ¶æ€
        show_task_list()
    else:
        # clarify {ID}: è¿›å…¥è¯¥ä»»åŠ¡çš„è¿”å·¥æµç¨‹
        rework_task(task_id)
```

**äº¤äº’æµç¨‹**:
1. `cc-spec clarify` - æ˜¾ç¤ºä»»åŠ¡åˆ—è¡¨å’ŒçŠ¶æ€
2. `cc-spec clarify 02-MODEL` - é’ˆå¯¹ç‰¹å®šä»»åŠ¡è¿›è¡Œè¿”å·¥è®¾è®¡

#### `cc-spec plan`

```python
@app.command()
def plan(
    change: str = typer.Argument(None, help="å˜æ›´åç§°")
):
    """ç”Ÿæˆæ‰§è¡Œè®¡åˆ’"""
    # 1. è¯»å– proposal.md
    # 2. åˆ†æä»£ç åº“ï¼ˆå¯é€‰è°ƒç”¨ AIï¼‰
    # 3. ç”Ÿæˆ tasks.mdï¼ˆWave åˆ†ç»„æ ¼å¼ï¼‰
    # 4. ç”Ÿæˆ design.mdï¼ˆæŠ€æœ¯å†³ç­–ï¼‰
```

**äº§å‡ºæ–‡ä»¶**:
```
.cc-spec/changes/{name}/
â”œâ”€â”€ proposal.md
â”œâ”€â”€ tasks.md         # Wave åˆ†ç»„çš„ä»»åŠ¡æ¸…å•
â”œâ”€â”€ design.md        # æŠ€æœ¯å†³ç­–æ–‡æ¡£
â””â”€â”€ status.yaml
```

#### `cc-spec apply`

```python
@app.command()
def apply(
    change: str = typer.Argument(None, help="å˜æ›´åç§°"),
    max_concurrent: int = typer.Option(10, help="æœ€å¤§å¹¶å‘æ•°")
):
    """æ‰§è¡Œä»»åŠ¡ï¼ˆSubAgent å¹¶å‘ï¼‰"""
    # 1. è¯»å– tasks.mdï¼Œè§£æ Wave åˆ†ç»„
    # 2. æŒ‰ Wave é¡ºåºæ‰§è¡Œï¼š
    #    - åŒä¸€ Wave å†…çš„ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼ˆSubAgentï¼‰
    #    - Wave ä¹‹é—´ä¸²è¡Œ
    # 3. ä¸» Agent è®°å½•æ‰§è¡Œæ—¥å¿—
    # 4. å¤±è´¥ä»»åŠ¡æ ‡è®°ï¼Œæ”¯æŒ clarify è¿”å·¥
```

**æ‰§è¡Œæœºåˆ¶**:
```python
for wave in waves:
    # å¹¶å‘å¯åŠ¨è¯¥ Wave çš„æ‰€æœ‰ä»»åŠ¡
    agents = []
    for task in wave.tasks:
        agent = Task(
            subagent_type="general-purpose",
            prompt=build_task_prompt(task),
            run_in_background=True
        )
        agents.append(agent)

    # ç­‰å¾…æ‰€æœ‰ SubAgent å®Œæˆ
    for agent in agents:
        result = TaskOutput(task_id=agent.id, block=True)
        update_task_status(task, result)
```

**ä¸» Agent èŒè´£ï¼ˆé‡è¦ï¼‰**:

ä¸» Agent åœ¨ apply é˜¶æ®µè´Ÿè´£**è°ƒåº¦å’Œæ±‡æ€»**ï¼Œå…·ä½“èŒè´£ï¼š

1. **ä»»åŠ¡åˆ†å‘**: è§£æ tasks.mdï¼ŒæŒ‰ Wave é¡ºåºåˆ†å‘ä»»åŠ¡ç»™ SubAgent
2. **ç»“æœæ”¶é›†**: ç­‰å¾… SubAgent å®Œæˆï¼Œæ”¶é›†æ‰§è¡Œç»“æœ
3. **æœ€ç»ˆçŠ¶æ€ç¡®è®¤**: æ ¹æ® SubAgent çš„æ‰§è¡Œç»“æœï¼Œç¡®è®¤ä»»åŠ¡æœ€ç»ˆçŠ¶æ€
4. **è¿›åº¦æ±‡æŠ¥**: æ¯å®Œæˆä¸€ä¸ª Waveï¼Œå‘ç”¨æˆ·æ±‡æŠ¥è¿›åº¦

**SubAgent èŒè´£ï¼ˆé‡è¦ï¼‰**:

SubAgent åœ¨æ‰§è¡Œä»»åŠ¡æ—¶è´Ÿè´£**æŠ¢å é”å’Œæ‰§è¡Œ**ï¼Œå‚è€ƒ auto-dev.md çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼š

1. **æŠ¢å ä»»åŠ¡é”ï¼ˆå¯åŠ¨æ—¶ï¼‰**:
   - æ›´æ–° tasks.md ä¸­å¯¹åº”ä»»åŠ¡çš„çŠ¶æ€ï¼šğŸŸ¦ ç©ºé—² â†’ ğŸŸ¨ è¿›è¡Œä¸­
   - è®°å½•å¼€å§‹æ—¶é—´å’Œ SubAgent ID
   ```markdown
   **çŠ¶æ€**: ğŸŸ¨ è¿›è¡Œä¸­
   **æ‰§è¡Œæ—¥å¿—**:
   - å¼€å§‹æ—¶é—´: 2024-01-15T10:30:00Z
   - SubAgent ID: agent_abc123
   ```

2. **æ‰§è¡Œä»»åŠ¡**: æŒ‰ç…§ Checklist é€é¡¹å®Œæˆ

3. **æ›´æ–° Checklist**: æ¯å®Œæˆä¸€é¡¹ï¼Œç«‹å³å‹¾é€‰
   - `- [ ]` â†’ `- [x]`

4. **æ ‡è®°å®Œæˆï¼ˆç»“æŸæ—¶ï¼‰**:
   - æ›´æ–°çŠ¶æ€ï¼šğŸŸ¨ è¿›è¡Œä¸­ â†’ ğŸŸ© å®Œæˆï¼ˆæˆ– ğŸŸ¥ å¤±è´¥ï¼‰
   - è®°å½•å®Œæˆæ—¶é—´å’Œæ‰§è¡Œç»“æœ
   ```markdown
   **çŠ¶æ€**: ğŸŸ© å®Œæˆ
   **æ‰§è¡Œæ—¥å¿—**:
   - å¼€å§‹æ—¶é—´: 2024-01-15T10:30:00Z
   - å®Œæˆæ—¶é—´: 2024-01-15T10:45:00Z
   - SubAgent ID: agent_abc123
   - æ‰§è¡Œç»“æœ: æˆåŠŸ
   ```

**çŠ¶æ€æµè½¬å›¾**:
```
ğŸŸ¦ ç©ºé—² â”€â”€(SubAgent å¯åŠ¨)â”€â”€â–º ğŸŸ¨ è¿›è¡Œä¸­ â”€â”€(æˆåŠŸ)â”€â”€â–º ğŸŸ© å®Œæˆ
                                    â”‚
                                    â””â”€â”€(å¤±è´¥)â”€â”€â–º ğŸŸ¥ å¤±è´¥ â”€â”€(clarify)â”€â”€â–º ğŸŸ¦ ç©ºé—²
```

**å¹¶å‘æ§åˆ¶æœºåˆ¶**:

å‚è€ƒ auto-dev.mdï¼Œä½¿ç”¨æ–‡ä»¶ä½œä¸ºåˆ†å¸ƒå¼é”ï¼š

1. SubAgent å¯åŠ¨å‰ï¼Œå…ˆè¯»å– tasks.md ç¡®è®¤ä»»åŠ¡çŠ¶æ€ä¸º ğŸŸ¦ ç©ºé—²
2. SubAgent æ›´æ–°çŠ¶æ€ä¸º ğŸŸ¨ è¿›è¡Œä¸­ï¼ˆå†™å…¥ SubAgent ID + æ—¶é—´æˆ³ï¼‰
3. å¦‚æœå¤šä¸ª SubAgent åŒæ—¶æŠ¢å åŒä¸€ä»»åŠ¡ï¼Œåå†™å…¥çš„ä¼šè¦†ç›–ï¼Œä½†ç”±äºæ˜¯å¹¶å‘åˆ†é…ï¼Œä¸» Agent ä¼šç¡®ä¿ä¸ä¼šåˆ†é…é‡å¤ä»»åŠ¡
4. SubAgent å®Œæˆåæ›´æ–°ä¸º ğŸŸ© å®Œæˆæˆ– ğŸŸ¥ å¤±è´¥

#### `cc-spec checklist`

```python
@app.command()
def checklist(
    change: str = typer.Argument(None, help="å˜æ›´åç§°")
):
    """éªŒæ”¶æ‰“åˆ†"""
    # 1. è¯»å– checklist-template.md
    # 2. é€é¡¹æ£€æŸ¥ï¼Œè®¡ç®—å¾—åˆ†
    # 3. å¾—åˆ† >= 80: é€šè¿‡ï¼Œå¯ä»¥ archive
    # 4. å¾—åˆ† < 80: æ ‡è®°å¤±è´¥é¡¹ï¼Œè¿”å› apply
```

**æ‰“åˆ†æœºåˆ¶**:
```yaml
è¯„åˆ†è§„åˆ™:
  - æ¯é¡¹æ£€æŸ¥ç‚¹ 0-10 åˆ†
  - æ€»åˆ† = å„é¡¹å¾—åˆ†ä¹‹å’Œ / æ»¡åˆ† * 100
  - é€šè¿‡é˜ˆå€¼: 80 åˆ†

å¤±è´¥å¤„ç†:
  - è®°å½•å¤±è´¥é¡¹åˆ° checklist-result.md
  - çŠ¶æ€å›é€€åˆ° apply
  - ç”¨æˆ·å¯é€šè¿‡ clarify {task-id} è¿”å·¥
```

#### `cc-spec archive`

```python
@app.command()
def archive(
    change: str = typer.Argument(None, help="å˜æ›´åç§°"),
    force: bool = typer.Option(False, help="è·³è¿‡ç¡®è®¤")
):
    """å½’æ¡£å˜æ›´"""
    # 1. æ£€æŸ¥ checklist æ˜¯å¦é€šè¿‡
    # 2. æ˜¾ç¤ºå°†æ›´æ–°çš„ specs åˆ—è¡¨
    # 3. ç”¨æˆ·ç¡®è®¤
    # 4. åˆå¹¶ Delta specs åˆ°ä¸» specs/
    # 5. ç§»åŠ¨åˆ° archive/YYYY-MM-DD-{name}/
```

**å½’æ¡£æµç¨‹**:
```
Before:
.cc-spec/
â”œâ”€â”€ specs/
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ spec.md (ç°æœ‰)
â””â”€â”€ changes/
    â””â”€â”€ add-oauth/
        â”œâ”€â”€ proposal.md
        â”œâ”€â”€ tasks.md
        â””â”€â”€ specs/
            â””â”€â”€ auth/
                â””â”€â”€ spec.md (Delta: ADDED/MODIFIED)

After:
.cc-spec/
â”œâ”€â”€ specs/
â”‚   â””â”€â”€ auth/
â”‚       â””â”€â”€ spec.md (å·²åˆå¹¶)
â””â”€â”€ changes/
    â””â”€â”€ archive/
        â””â”€â”€ 2024-01-15-add-oauth/
            â”œâ”€â”€ proposal.md
            â”œâ”€â”€ tasks.md
            â””â”€â”€ specs/...
```

#### `cc-spec quick-delta`

```python
@app.command()
def quick_delta(
    message: str = typer.Argument(..., help="å˜æ›´æè¿°")
):
    """è¶…ç®€å•æ¨¡å¼ï¼šä¸€æ­¥ç”Ÿæˆå˜æ›´è®°å½•"""
    # 1. è‡ªåŠ¨ç”Ÿæˆå˜æ›´åç§° (æ—¶é—´æˆ³ + ç®€çŸ­æè¿°)
    # 2. åˆ›å»º mini-proposal.md
    # 3. ç›´æ¥å½’æ¡£åˆ° archive/
    # ç”¨äºï¼šå°æ”¹åŠ¨ã€ç´§æ€¥ä¿®å¤ã€é…ç½®è°ƒæ•´
```

---

## æ•°æ®ç»“æ„è®¾è®¡

### ç›®å½•ç»“æ„

```
project/
â”œâ”€â”€ .cc-spec/                    # cc-spec å·¥ä½œç›®å½•
â”‚   â”œâ”€â”€ config.yaml              # å·¥å…·é…ç½®
â”‚   â”œâ”€â”€ templates/               # æ¨¡æ¿æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ spec-template.md
â”‚   â”‚   â”œâ”€â”€ plan-template.md
â”‚   â”‚   â”œâ”€â”€ tasks-template.md
â”‚   â”‚   â””â”€â”€ checklist-template.md
â”‚   â”œâ”€â”€ specs/                   # ä¸»è§„æ ¼ï¼ˆå·²æ„å»ºçš„çœŸå®çŠ¶æ€ï¼‰
â”‚   â”‚   â””â”€â”€ {capability}/
â”‚   â”‚       â”œâ”€â”€ spec.md
â”‚   â”‚       â””â”€â”€ design.md
â”‚   â””â”€â”€ changes/                 # å˜æ›´ç›®å½•
â”‚       â”œâ”€â”€ {change-name}/       # å½“å‰å˜æ›´
â”‚       â”‚   â”œâ”€â”€ proposal.md
â”‚       â”‚   â”œâ”€â”€ tasks.md
â”‚       â”‚   â”œâ”€â”€ design.md
â”‚       â”‚   â”œâ”€â”€ checklist-result.md
â”‚       â”‚   â”œâ”€â”€ status.yaml
â”‚       â”‚   â””â”€â”€ specs/           # Delta å˜æ›´
â”‚       â”‚       â””â”€â”€ {capability}/
â”‚       â”‚           â””â”€â”€ spec.md
â”‚       â””â”€â”€ archive/             # å·²å½’æ¡£å˜æ›´
â”‚           â””â”€â”€ YYYY-MM-DD-{name}/
â””â”€â”€ .claude/                     # Claude Code é…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
    â””â”€â”€ commands/
        â””â”€â”€ cc-spec.md           # æ–œæ å‘½ä»¤
```

### æ ¸å¿ƒæ–‡ä»¶æ ¼å¼

#### config.yaml

```yaml
version: "1.0"
agent: "claude"                  # å½“å‰ä½¿ç”¨çš„ AI å·¥å…·
project_name: "my-project"

# æŠ€æœ¯ç¡¬è¦æ±‚ï¼ˆä»é¡¹ç›®é…ç½®æ–‡ä»¶è¯»å–ï¼‰
tech_requirements_sources:
  - ".claude/CLAUDE.md"
  - "AGENTS.md"
  - "pyproject.toml"
  - "package.json"

# SubAgent é…ç½®
subagent:
  max_concurrent: 10
  timeout: 300000                # 5 åˆ†é’Ÿè¶…æ—¶

# æ‰“åˆ†é…ç½®
checklist:
  pass_threshold: 80
  auto_retry: false
```

#### status.yaml

```yaml
change_name: "add-oauth"
created_at: "2024-01-15T10:00:00Z"
current_stage: "apply"           # specify | clarify | plan | apply | checklist | archive

stages:
  specify:
    status: "completed"
    completed_at: "2024-01-15T10:05:00Z"
  clarify:
    status: "completed"
    completed_at: "2024-01-15T10:15:00Z"
  plan:
    status: "completed"
    completed_at: "2024-01-15T10:30:00Z"
  apply:
    status: "in_progress"
    started_at: "2024-01-15T10:35:00Z"
    waves_completed: 1
    waves_total: 3
  checklist:
    status: "pending"
  archive:
    status: "pending"

tasks:
  - id: "01-SETUP"
    status: "completed"
    wave: 0
  - id: "02-MODEL"
    status: "in_progress"
    wave: 1
  - id: "03-API"
    status: "pending"
    wave: 1
```

#### tasks.md æ ¼å¼

```markdown
# Tasks - {change-name}

## æ¦‚è§ˆ

| Wave | Task-ID | é¢„ä¼° | çŠ¶æ€ | ä¾èµ– |
|------|---------|------|------|------|
| 0 | 01-SETUP | 30k | ğŸŸ© å®Œæˆ | - |
| 1 | 02-MODEL | 50k | ğŸŸ¨ è¿›è¡Œä¸­ | 01-SETUP |
| 1 | 03-API | 45k | ğŸŸ¦ ç©ºé—² | 01-SETUP |
| 2 | 04-FE | 60k | ğŸŸ¦ ç©ºé—² | 03-API |

## ä»»åŠ¡è¯¦æƒ…

### Task: 01-SETUP
**é¢„ä¼°ä¸Šä¸‹æ–‡**: ~30k tokens
**çŠ¶æ€**: ğŸŸ© å®Œæˆ
**ä¾èµ–**: æ— 

**å¿…è¯»æ–‡æ¡£**:
- docs/plan/spec.md
- .cc-spec/changes/{name}/design.md

**æ ¸å¿ƒä»£ç å…¥å£**:
- src/config/

**Checklist**:
- [x] åˆ›å»ºé…ç½®æ–‡ä»¶
- [x] æ·»åŠ ç¯å¢ƒå˜é‡

**æ‰§è¡Œæ—¥å¿—**:
- å®Œæˆæ—¶é—´: 2024-01-15T10:40:00Z
- SubAgent ID: agent_abc123

---

### Task: 02-MODEL
**é¢„ä¼°ä¸Šä¸‹æ–‡**: ~50k tokens
**çŠ¶æ€**: ğŸŸ¨ è¿›è¡Œä¸­
**ä¾èµ–**: 01-SETUP

**å¿…è¯»æ–‡æ¡£**:
- docs/plan/spec.md
- src/models/README.md

**æ ¸å¿ƒä»£ç å…¥å£**:
- src/models/

**Checklist**:
- [ ] åˆ›å»ºæ•°æ®æ¨¡å‹
- [ ] æ·»åŠ éªŒè¯é€»è¾‘
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
```

#### Delta spec.md æ ¼å¼

```markdown
# Delta: {capability}

## ADDED Requirements

### Requirement: OAuth2 Authentication
The system SHALL support OAuth2 authentication flow.

#### Scenario: Google OAuth Success
- Given: User clicks "Login with Google"
- When: OAuth flow completes successfully
- Then: User session is created

## MODIFIED Requirements

### Requirement: User Session Management
[å®Œæ•´ä¿®æ”¹åçš„å†…å®¹ï¼Œä¸æ˜¯ diff]

The system SHALL manage user sessions with the following rules:
- Session timeout: 24 hours (modified from 1 hour)
- Refresh token support: enabled

## REMOVED Requirements

### Requirement: Basic Auth Support
**Reason**: Replaced by OAuth2
**Migration**: Existing basic auth users will be prompted to link OAuth account

## RENAMED Requirements

- FROM: `### Requirement: Login Flow`
- TO: `### Requirement: Authentication Flow`
```

---

## æ¨¡å—æ¶æ„

```
cc_spec/
â”œâ”€â”€ __init__.py              # CLI å…¥å£ (typer app)
â”œâ”€â”€ __main__.py              # python -m cc_spec
â”œâ”€â”€ commands/                # å‘½ä»¤å®ç°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ init.py              # cc-spec init
â”‚   â”œâ”€â”€ specify.py           # cc-spec specify
â”‚   â”œâ”€â”€ clarify.py           # cc-spec clarify
â”‚   â”œâ”€â”€ plan.py              # cc-spec plan
â”‚   â”œâ”€â”€ apply.py             # cc-spec apply
â”‚   â”œâ”€â”€ checklist.py         # cc-spec checklist
â”‚   â”œâ”€â”€ archive.py           # cc-spec archive
â”‚   â””â”€â”€ quick_delta.py       # cc-spec quick-delta
â”œâ”€â”€ core/                    # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ state.py             # çŠ¶æ€ç®¡ç† (status.yaml)
â”‚   â”œâ”€â”€ templates.py         # æ¨¡æ¿å¤„ç†
â”‚   â”œâ”€â”€ delta.py             # Delta è§£æä¸åˆå¹¶
â”‚   â””â”€â”€ scoring.py           # æ‰“åˆ†æœºåˆ¶
â”œâ”€â”€ subagent/                # SubAgent ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ executor.py          # å¹¶å‘æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ task_parser.py       # tasks.md è§£æ
â”‚   â””â”€â”€ result_collector.py  # ç»“æœæ”¶é›†
â”œâ”€â”€ ui/                      # ç»ˆç«¯ UI
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ display.py           # rich æ˜¾ç¤ºç»„ä»¶
â”‚   â”œâ”€â”€ progress.py          # è¿›åº¦æ¡
â”‚   â””â”€â”€ prompts.py           # äº¤äº’æç¤º
â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ files.py             # æ–‡ä»¶æ“ä½œ
    â”œâ”€â”€ git.py               # Git æ“ä½œ
    â””â”€â”€ download.py          # æ¨¡æ¿ä¸‹è½½
```

---

## ç¯å¢ƒä¸é…ç½®

### ä¾èµ–é¡¹

```toml
# pyproject.toml
[project]
name = "cc-spec"
version = "0.1.0"
requires-python = ">=3.11"

dependencies = [
    "typer>=0.9.0",
    "rich>=13.0.0",
    "httpx>=0.25.0",
    "readchar>=4.0.0",
    "pyyaml>=6.0",
    "truststore>=0.8.0",
]

[project.scripts]
cc-spec = "cc_spec:main"
```

### å®‰è£…æ–¹å¼

```bash
# æ–¹å¼ 1: uvx ç›´æ¥è¿è¡Œï¼ˆæ¨èï¼Œæ— éœ€å®‰è£…ï¼‰
uvx --from git+https://github.com/<owner>/cc-spec.git cc-spec init

# æ–¹å¼ 2: å…¨å±€å®‰è£…
uv tool install cc-spec --from git+https://github.com/<owner>/cc-spec.git
cc-spec init

# æ–¹å¼ 3: å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
uv tool install cc-spec --force --from git+https://github.com/<owner>/cc-spec.git

# æ–¹å¼ 4: æœ¬åœ°å¼€å‘å®‰è£…
git clone https://github.com/<owner>/cc-spec.git
cd cc-spec
uv pip install -e .
```

**æ³¨æ„**: æš‚ä¸å‘å¸ƒåˆ° PyPIï¼Œä»…é€šè¿‡ GitHub ä»“åº“å®‰è£…ã€‚

### ç¯å¢ƒå˜é‡

```bash
# å¯é€‰ï¼šè‡ªå®šä¹‰æ¨¡æ¿æº
CC_SPEC_TEMPLATE_URL="https://github.com/user/cc-spec-templates/releases/latest"

# å¯é€‰ï¼šè°ƒè¯•æ¨¡å¼
CC_SPEC_DEBUG=1

# å¯é€‰ï¼šSubAgent è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
CC_SPEC_SUBAGENT_TIMEOUT=300000
```

---

## SubAgent é›†æˆè®¾è®¡

### æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸» Agent (Claude Code)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. è¯»å– tasks.md                                           â”‚
â”‚  2. è§£æ Wave åˆ†ç»„                                          â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Wave 0 (ä¸²è¡Œå®Œæˆåæ‰è¿›å…¥ Wave 1)                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Task 01-SETUP (SubAgent #1)                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Wave 1 (å¹¶å‘æ‰§è¡Œ)                                    â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Task 02-MODEL (SubAgent #2) â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Task 03-API   (SubAgent #3) â”€â”€â”¼â”€â”€ å¹¶å‘        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Wave 2 (ä¾èµ– Wave 1 å®Œæˆ)                            â”‚   â”‚
â”‚  â”‚  â””â”€â”€ Task 04-FE (SubAgent #4)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  3. æ”¶é›†ç»“æœï¼Œæ›´æ–° tasks.md çŠ¶æ€                            â”‚
â”‚  4. è®°å½•æ‰§è¡Œæ—¥å¿—                                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SubAgent Prompt æ„å»º

```python
def build_task_prompt(task: Task, context: Context) -> str:
    return f"""
## ä»»åŠ¡ä¿¡æ¯
- Task ID: {task.id}
- æ‰€å±å˜æ›´: {context.change_name}
- tasks.md è·¯å¾„: {context.tasks_md_path}

## æ‰§è¡Œæµç¨‹ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰

### 1. æŠ¢å ä»»åŠ¡é”ï¼ˆé¦–å…ˆæ‰§è¡Œï¼‰
åœ¨å¼€å§‹ä»»ä½•å·¥ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ›´æ–° tasks.mdï¼š
- æ‰¾åˆ° Task: {task.id} çš„è¯¦æƒ…éƒ¨åˆ†
- å°† **çŠ¶æ€**: ğŸŸ¦ ç©ºé—² æ”¹ä¸º **çŠ¶æ€**: ğŸŸ¨ è¿›è¡Œä¸­
- æ·»åŠ æ‰§è¡Œæ—¥å¿—ï¼š
  ```
  **æ‰§è¡Œæ—¥å¿—**:
  - å¼€å§‹æ—¶é—´: [å½“å‰æ—¶é—´]
  - SubAgent ID: [ä½ çš„ agent ID]
  ```

### 2. æ‰§è¡Œä»»åŠ¡
æŒ‰ä»¥ä¸‹ Checklist é€é¡¹å®Œæˆï¼Œæ¯å®Œæˆä¸€é¡¹ç«‹å³å‹¾é€‰ï¼ˆ [ ] â†’ [x] ï¼‰

### 3. æ ‡è®°å®Œæˆï¼ˆæœ€åæ‰§è¡Œï¼‰
ä»»åŠ¡å®Œæˆåï¼Œæ›´æ–° tasks.mdï¼š
- å°† **çŠ¶æ€**: ğŸŸ¨ è¿›è¡Œä¸­ æ”¹ä¸º **çŠ¶æ€**: ğŸŸ© å®Œæˆï¼ˆæˆ– ğŸŸ¥ å¤±è´¥ï¼‰
- æ›´æ–°æ‰§è¡Œæ—¥å¿—æ·»åŠ å®Œæˆæ—¶é—´å’Œç»“æœ
- åŒæ—¶æ›´æ–°ä»»åŠ¡æ€»è§ˆè¡¨æ ¼ä¸­çš„çŠ¶æ€

## å¿…è¯»æ–‡æ¡£
{task.required_docs}

## æ ¸å¿ƒä»£ç å…¥å£
{task.code_entries}

## ä»»åŠ¡ Checklist
{task.checklist}

## æŠ€æœ¯çº¦æŸ
{context.tech_requirements}

## é‡è¦æé†’
1. å¿…é¡»å…ˆæ›´æ–° tasks.md æ ‡è®°å¼€å§‹ï¼Œå†æ‰§è¡Œä»»åŠ¡
2. æ¯å®Œæˆä¸€ä¸ª Checklist é¡¹ï¼Œç«‹å³åœ¨ tasks.md ä¸­å‹¾é€‰
3. ä»»åŠ¡å®Œæˆåï¼Œå¿…é¡»æ›´æ–° tasks.md æ ‡è®°å®ŒæˆçŠ¶æ€
4. éµå¾ªé¡¹ç›®ç°æœ‰ä»£ç é£æ ¼
5. ä¸ä¿®æ”¹ä»»åŠ¡èŒƒå›´å¤–çš„æ–‡ä»¶
"""
```

### é”™è¯¯å¤„ç†

```yaml
SubAgent å¤±è´¥å¤„ç†:
  timeout:
    - è®°å½•è¶…æ—¶ä»»åŠ¡
    - æ ‡è®°çŠ¶æ€ä¸º "timeout"
    - ä¸è‡ªåŠ¨é‡è¯•ï¼Œç­‰å¾…ç”¨æˆ· clarify

  error:
    - è®°å½•é”™è¯¯ä¿¡æ¯
    - æ ‡è®°çŠ¶æ€ä¸º "failed"
    - ä¿ç•™éƒ¨åˆ†å®Œæˆçš„å·¥ä½œ

  partial:
    - Checklist éƒ¨åˆ†å®Œæˆ
    - æ ‡è®°çŠ¶æ€ä¸º "partial"
    - checklist é˜¶æ®µé‡ç‚¹æ£€æŸ¥
```

### ä¸» Agent è°ƒç”¨ SubAgent è§„èŒƒï¼ˆé‡è¦ï¼‰

**ä¸ºç¡®ä¿ SubAgent èƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œä»»åŠ¡ï¼Œä¸» Agent åœ¨æ„å»º Prompt æ—¶å¿…é¡»åŒ…å«ä»¥ä¸‹å®Œæ•´ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š**

#### 1. å¿…é¡»åŒ…å«çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

```markdown
## 1. é¡¹ç›®æŠ€æœ¯è¦æ±‚
- Python ç‰ˆæœ¬: 3.12+
- åŒ…ç®¡ç†å™¨: uv
- æµ‹è¯•æ¡†æ¶: pytest
- ä¾èµ–é¡¹: [ä» pyproject.toml è¯»å–]
- ä»£ç é£æ ¼: [ä»ç°æœ‰ä»£ç æ¨æ–­]

## 2. å¯ç”¨å·¥å…·è¯´æ˜
ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·å®Œæˆä»»åŠ¡ï¼š
- **Read**: è¯»å–æ–‡ä»¶å†…å®¹
- **Write**: åˆ›å»ºæ–°æ–‡ä»¶
- **Edit**: ç¼–è¾‘ç°æœ‰æ–‡ä»¶ï¼ˆæ›¿æ¢æŒ‡å®šå†…å®¹ï¼‰
- **Glob**: æŒ‰æ¨¡å¼æœç´¢æ–‡ä»¶
- **Grep**: åœ¨æ–‡ä»¶ä¸­æœç´¢å†…å®¹
- **Bash**: æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚ `uv run pytest`ï¼‰

## 3. ç°æœ‰ä»£ç å‚è€ƒ
è¯·å…ˆé˜…è¯»ä»¥ä¸‹æ–‡ä»¶äº†è§£é¡¹ç›®ä»£ç é£æ ¼ï¼š
- [åˆ—å‡ºç›¸å…³æ¨¡å—æ–‡ä»¶è·¯å¾„]

## 4. ä¾èµ–æ¨¡å—è¯´æ˜
æœ¬ä»»åŠ¡ä¾èµ–ä»¥ä¸‹å·²å®ç°çš„æ¨¡å—ï¼š
- [æ¨¡å—è·¯å¾„]: [ç®€è¦è¯´æ˜]
- [å¯ä»¥ç›´æ¥ import ä½¿ç”¨çš„å‡½æ•°/ç±»]

## 5. è¾“å‡ºè¦æ±‚
- æºä»£ç æ–‡ä»¶è·¯å¾„: [å…·ä½“è·¯å¾„]
- æµ‹è¯•æ–‡ä»¶è·¯å¾„: [å…·ä½“è·¯å¾„]
- å‘½åè§„èŒƒ: [snake_case / PascalCase ç­‰]
```

#### 2. Prompt æ¨¡æ¿ç»“æ„

```python
SUBAGENT_PROMPT_TEMPLATE = """
ä½ æ˜¯ {project_name} é¡¹ç›®çš„å¼€å‘è€…ã€‚è¯·å®ç° **{task_id}** ä»»åŠ¡ï¼š{task_name}ã€‚

## é¡¹ç›®èƒŒæ™¯
{project_description}

## æŠ€æœ¯æ ˆ
- è¯­è¨€: Python {python_version}
- åŒ…ç®¡ç†: uv
- æµ‹è¯•: pytest + pytest-cov + pytest-asyncio
- ä¾èµ–: {dependencies}

## å¯ç”¨å·¥å…·
ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š
- Read: è¯»å–æ–‡ä»¶ï¼ˆå¿…é¡»å…ˆè¯»å–å†ç¼–è¾‘ï¼‰
- Write: åˆ›å»ºæ–°æ–‡ä»¶
- Edit: ç¼–è¾‘æ–‡ä»¶ï¼ˆold_string å¿…é¡»å”¯ä¸€ï¼‰
- Glob: æœç´¢æ–‡ä»¶ `Glob(pattern="**/*.py")`
- Grep: æœç´¢å†…å®¹ `Grep(pattern="class.*", path="src/")`
- Bash: æ‰§è¡Œå‘½ä»¤ `Bash(command="uv run pytest tests/ -v")`

## ä»£ç é£æ ¼å‚è€ƒ
è¯·å…ˆé˜…è¯»ä»¥ä¸‹æ–‡ä»¶äº†è§£ä»£ç é£æ ¼ï¼š
{reference_files}

## å·²å®ç°çš„ä¾èµ–æ¨¡å—
{dependency_modules}

## ä»»åŠ¡è¦æ±‚
{task_requirements}

### Checklistï¼ˆå¿…é¡»å®Œæˆï¼‰
{checklist}

## è¾“å‡ºæ–‡ä»¶
- æºä»£ç : {source_file_path}
- æµ‹è¯•: {test_file_path}

## éªŒè¯æ–¹æ³•
å®Œæˆåè¿è¡Œæµ‹è¯•éªŒè¯ï¼š
```bash
uv run pytest {test_file_path} -v
```
"""
```

#### 3. è°ƒç”¨æœ€ä½³å®è·µ

```python
# âœ“ æ­£ç¡®åšæ³•ï¼šæä¾›å®Œæ•´ä¸Šä¸‹æ–‡
def build_complete_prompt(task: Task, project: Project) -> str:
    return SUBAGENT_PROMPT_TEMPLATE.format(
        project_name=project.name,
        task_id=task.id,
        task_name=task.name,
        project_description=project.description,
        python_version="3.12+",
        dependencies=read_dependencies_from_pyproject(),
        reference_files=get_reference_files(task),
        dependency_modules=describe_dependency_modules(task),
        task_requirements=task.detailed_requirements,
        checklist=format_checklist(task.checklist),
        source_file_path=task.output_path,
        test_file_path=task.test_path,
    )

# âœ— é”™è¯¯åšæ³•ï¼šç¼ºå°‘ä¸Šä¸‹æ–‡
def build_incomplete_prompt(task: Task) -> str:
    # ç¼ºå°‘ï¼šæŠ€æœ¯æ ˆã€å·¥å…·è¯´æ˜ã€ä»£ç é£æ ¼ã€ä¾èµ–æ¨¡å—
    return f"å®ç° {task.name}ï¼Œè¦æ±‚ï¼š{task.requirements}"
```

#### 4. ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥æº

| ä¿¡æ¯ç±»å‹ | æ¥æº | è¯»å–æ–¹å¼ |
|---------|------|---------|
| Python ç‰ˆæœ¬ | pyproject.toml | `Read("pyproject.toml")` |
| ä¾èµ–é¡¹ | pyproject.toml | è§£æ `[project.dependencies]` |
| ä»£ç é£æ ¼ | åŒç±»æ¨¡å—æ–‡ä»¶ | `Read("src/cc_spec/core/*.py")` |
| é¡¹ç›®ç»“æ„ | ç›®å½•æ ‘ | `Glob("src/**/*.py")` |
| æŠ€æœ¯çº¦æŸ | CLAUDE.md / AGENTS.md | `Read(".claude/CLAUDE.md")` |

#### 5. SubAgent å“åº”éªŒè¯

ä¸» Agent åœ¨æ”¶åˆ° SubAgent ç»“æœååº”éªŒè¯ï¼š
1. **æ–‡ä»¶åˆ›å»º**: æ£€æŸ¥è¾“å‡ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. **æµ‹è¯•é€šè¿‡**: è¿è¡Œ `uv run pytest {test_path} -v`
3. **ä»£ç è´¨é‡**: æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯
4. **Checklist å®Œæˆåº¦**: ç»Ÿè®¡å®Œæˆé¡¹æ•°é‡

```python
async def validate_subagent_result(task: Task, result: ExecutionResult) -> bool:
    # 1. æ£€æŸ¥æºæ–‡ä»¶å­˜åœ¨
    if not Path(task.output_path).exists():
        return False

    # 2. è¿è¡Œæµ‹è¯•
    test_result = await run_tests(task.test_path)
    if not test_result.passed:
        return False

    # 3. æ£€æŸ¥ Checklist å®Œæˆåº¦
    completed = count_completed_checklist_items(task)
    total = len(task.checklist)
    if completed < total:
        return False

    return True
```

---

## å·¥å…·é›†æˆ

### AI å·¥å…·é…ç½®

ç»§æ‰¿ Spec-Kit çš„ AGENT_CONFIGï¼Œæ”¯æŒ 17+ AI å·¥å…·ï¼š

```python
AGENT_CONFIG = {
    "claude": {
        "name": "Claude Code",
        "folder": ".claude/",
        "cli_required": True,
        "commands_folder": "commands/cc-spec/",
        "file_format": "markdown",
        "supports_apply": True,  # æ”¯æŒ SubAgent æ‰§è¡Œ
    },
    "cursor": {
        "name": "Cursor",
        "folder": ".cursor/",
        "cli_required": False,
        "commands_folder": "commands/",
        "file_format": "markdown",
        "supports_apply": False,  # ä»…æ”¯æŒè§„åˆ’é˜¶æ®µ
    },
    "gemini": {
        "name": "Gemini CLI",
        "folder": ".gemini/",
        "cli_required": True,
        "commands_folder": "commands/cc-spec/",
        "file_format": "toml",  # Gemini ä½¿ç”¨ TOML æ ¼å¼
        "supports_apply": False,
    },
    "copilot": {
        "name": "GitHub Copilot",
        "folder": ".github/",
        "cli_required": False,
        "commands_folder": "prompts/",
        "file_format": "markdown",
        "supports_apply": False,
    },
    "amazonq": {
        "name": "Amazon Q Developer",
        "folder": ".amazonq/",
        "cli_required": True,
        "commands_folder": "prompts/",
        "file_format": "markdown",
        "command_prefix": "@",  # Amazon Q ä½¿ç”¨ @ å‰ç¼€
        "supports_apply": False,
    },
    "windsurf": {
        "name": "Windsurf",
        "folder": ".windsurf/",
        "cli_required": False,
        "commands_folder": "workflows/",
        "file_format": "markdown",
        "supports_apply": False,
    },
    "qwen": {
        "name": "Qwen Code",
        "folder": ".qwen/",
        "cli_required": True,
        "commands_folder": "commands/cc-spec/",
        "file_format": "toml",  # Qwen ä½¿ç”¨ TOML æ ¼å¼
        "supports_apply": False,
    },
    # ... å…¶ä»–å·¥å…·å‚è€ƒ OpenSpec çš„é…ç½®
}
```

### é˜¶æ®µä¸å·¥å…·æ”¯æŒ

| é˜¶æ®µ | Claude Code | Cursor | Gemini | å…¶ä»– |
|------|-------------|--------|--------|------|
| init | âœ… | âœ… | âœ… | âœ… |
| specify | âœ… | âœ… | âœ… | âœ… |
| clarify | âœ… | âœ… | âœ… | âœ… |
| plan | âœ… | âœ… | âœ… | âœ… |
| **apply** | âœ… (SubAgent) | âŒ | âŒ | âŒ |
| checklist | âœ… | âœ… | âœ… | âœ… |
| archive | âœ… | âœ… | âœ… | âœ… |

---

## å¤šå·¥å…·å‘½ä»¤é›†æˆ

### è®¾è®¡åŸåˆ™

å‚è€ƒ OpenSpec çš„é€‚é…å™¨æ¨¡å¼ï¼Œcc-spec åœ¨ `init` æ—¶ä¸ºç”¨æˆ·é€‰æ‹©çš„ AI å·¥å…·ç”Ÿæˆå¯¹åº”çš„å‘½ä»¤æ–‡ä»¶ï¼š

```
ç”¨æˆ·åœ¨å·¥å…·è¾“å…¥æ¡†è¾“å…¥æ–œæ å‘½ä»¤ â†’ è§¦å‘å¯¹åº”çš„å·¥ä½œæµ
```

### å‘½ä»¤æ–‡ä»¶ç”Ÿæˆ

#### Claude Code (Markdown + YAML frontmatter)

```
.claude/commands/cc-spec/
â”œâ”€â”€ specify.md
â”œâ”€â”€ clarify.md
â”œâ”€â”€ plan.md
â”œâ”€â”€ apply.md
â”œâ”€â”€ checklist.md
â””â”€â”€ archive.md
```

**æ–‡ä»¶æ ¼å¼**:
```markdown
---
description: åˆ›å»ºæ–°çš„å˜æ›´è§„æ ¼
---

<!-- CC-SPEC:START -->
## å·¥ä½œæµ: cc-spec specify

**æ­¥éª¤**:
1. è¿è¡Œ `cc-spec specify <change-name>`
2. ç¼–è¾‘ç”Ÿæˆçš„ proposal.md
3. å®Œæˆåè¿è¡Œ `/cc-spec:clarify` è¿›è¡Œæ¾„æ¸…

**å‚è€ƒæ–‡æ¡£**:
- .cc-spec/changes/<name>/proposal.md
<!-- CC-SPEC:END -->
```

**è°ƒç”¨æ–¹å¼**: `/cc-spec:specify add-oauth`

#### Cursor (Markdown)

```
.cursor/commands/
â”œâ”€â”€ cc-spec-specify.md
â”œâ”€â”€ cc-spec-clarify.md
â”œâ”€â”€ cc-spec-plan.md
â””â”€â”€ ...
```

**è°ƒç”¨æ–¹å¼**: `/cc-spec-specify add-oauth`

#### Gemini CLI (TOML)

```
.gemini/commands/cc-spec/
â”œâ”€â”€ specify.toml
â”œâ”€â”€ clarify.toml
â”œâ”€â”€ plan.toml
â””â”€â”€ ...
```

**æ–‡ä»¶æ ¼å¼**:
```toml
description = "åˆ›å»ºæ–°çš„å˜æ›´è§„æ ¼"

prompt = """
<!-- CC-SPEC:START -->
## å·¥ä½œæµ: cc-spec specify

è¯·å¸®æˆ‘æ‰§è¡Œ cc-spec specify å‘½ä»¤ã€‚

ç”¨æˆ·è¾“å…¥: {{args}}

**æ­¥éª¤**:
1. è¿è¡Œ `cc-spec specify <change-name>`
...
<!-- CC-SPEC:END -->
"""
```

**è°ƒç”¨æ–¹å¼**: `/cc-spec:specify add-oauth`

#### GitHub Copilot (Markdown)

```
.github/prompts/
â”œâ”€â”€ cc-spec-specify.prompt.md
â”œâ”€â”€ cc-spec-clarify.prompt.md
â””â”€â”€ ...
```

**è°ƒç”¨æ–¹å¼**: åœ¨ Copilot æç¤ºåº“ä¸­é€‰æ‹©

#### Amazon Q (Markdown + XML)

```
.amazonq/prompts/
â”œâ”€â”€ cc-spec-specify.md
â”œâ”€â”€ cc-spec-clarify.md
â””â”€â”€ ...
```

**æ–‡ä»¶æ ¼å¼**:
```markdown
---
description: åˆ›å»ºæ–°çš„å˜æ›´è§„æ ¼
---

ç”¨æˆ·è¯·æ±‚åˆ›å»ºå˜æ›´è§„æ ¼:

<UserRequest>
$ARGUMENTS
</UserRequest>

<!-- CC-SPEC:START -->
## å·¥ä½œæµè¯´æ˜
...
<!-- CC-SPEC:END -->
```

**è°ƒç”¨æ–¹å¼**: `@cc-spec-specify add-oauth`

#### å…¶ä»–å·¥å…· (AGENTS.md)

å¯¹äºä¸æ”¯æŒåŸç”Ÿæ–œæ å‘½ä»¤çš„å·¥å…·ï¼Œç”Ÿæˆé€šç”¨çš„ `AGENTS.md`:

```markdown
# CC-Spec å·¥ä½œæµæŒ‡å—

## å¯ç”¨å‘½ä»¤

å½“ç”¨æˆ·è¯·æ±‚æ‰§è¡Œ cc-spec å·¥ä½œæµæ—¶ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œ:

### specify - åˆ›å»ºå˜æ›´è§„æ ¼
```bash
cc-spec specify <change-name>
```

### clarify - æ¾„æ¸…éœ€æ±‚
```bash
cc-spec clarify [task-id]
```

### plan - ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
```bash
cc-spec plan [change-name]
```

...
```

### æ‰˜ç®¡æ ‡è®°å—

ä½¿ç”¨ `<!-- CC-SPEC:START -->` å’Œ `<!-- CC-SPEC:END -->` æ ‡è®°æ‰˜ç®¡å†…å®¹ï¼š

- `cc-spec init` é¦–æ¬¡ç”Ÿæˆå‘½ä»¤æ–‡ä»¶
- `cc-spec update` åˆ·æ–°æ ‡è®°å—å†…çš„å†…å®¹ï¼Œä¿ç•™ç”¨æˆ·è‡ªå®šä¹‰çš„ frontmatter
- ç”¨æˆ·å¯ä»¥åœ¨æ ‡è®°å—å¤–æ·»åŠ è‡ªå®šä¹‰å†…å®¹

### init å‘½ä»¤å¢å¼º

```python
@app.command()
def init(
    project: str = typer.Argument(None),
    agents: list[str] = typer.Option(None, help="è¦æ”¯æŒçš„ AI å·¥å…·"),
    all_agents: bool = typer.Option(False, help="æ”¯æŒæ‰€æœ‰ AI å·¥å…·"),
):
    """åˆå§‹åŒ– cc-spec å·¥ä½œæµ"""
    # 1. åˆ›å»º .cc-spec/ ç›®å½•
    # 2. äº¤äº’å¼é€‰æ‹© AI å·¥å…·ï¼ˆå¦‚æœæœªæŒ‡å®šï¼‰
    # 3. ä¸ºæ¯ä¸ªé€‰ä¸­çš„å·¥å…·ç”Ÿæˆå‘½ä»¤æ–‡ä»¶
    # 4. ç”Ÿæˆ AGENTS.mdï¼ˆé€šç”¨æŒ‡ä»¤ï¼‰
```

### å‘½ä»¤ç”Ÿæˆå™¨æ¶æ„

```python
# cc_spec/core/command_generator.py

class CommandGenerator:
    """å‘½ä»¤æ–‡ä»¶ç”Ÿæˆå™¨åŸºç±»"""

    def generate_all(self, project_path: Path):
        """ç”Ÿæˆæ‰€æœ‰å‘½ä»¤æ–‡ä»¶"""
        for cmd in ["specify", "clarify", "plan", "apply", "checklist", "archive"]:
            self.generate_command(cmd, project_path)

    def update_existing(self, project_path: Path):
        """æ›´æ–°ç°æœ‰å‘½ä»¤æ–‡ä»¶ï¼ˆä¿ç•™ frontmatterï¼‰"""
        ...

class ClaudeCommandGenerator(CommandGenerator):
    """Claude Code å‘½ä»¤ç”Ÿæˆå™¨"""
    file_format = "markdown"
    folder = ".claude/commands/cc-spec/"

class GeminiCommandGenerator(CommandGenerator):
    """Gemini CLI å‘½ä»¤ç”Ÿæˆå™¨"""
    file_format = "toml"
    folder = ".gemini/commands/cc-spec/"

# æ³¨å†Œè¡¨
COMMAND_GENERATORS = {
    "claude": ClaudeCommandGenerator,
    "gemini": GeminiCommandGenerator,
    "cursor": CursorCommandGenerator,
    # ...
}
```

### å·¥å…·è°ƒç”¨æ±‡æ€»

| å·¥å…· | è¾“å…¥æ¡†è°ƒç”¨æ–¹å¼ | ç¤ºä¾‹ |
|------|---------------|------|
| Claude Code | `/cc-spec:specify` | `/cc-spec:specify add-oauth` |
| Cursor | `/cc-spec-specify` | `/cc-spec-specify add-oauth` |
| Gemini CLI | `/cc-spec:specify` | `/cc-spec:specify add-oauth` |
| GitHub Copilot | æç¤ºåº“é€‰æ‹© | é€‰æ‹© "cc-spec-specify" |
| Amazon Q | `@cc-spec-specify` | `@cc-spec-specify add-oauth` |
| Windsurf | å·¥ä½œæµé¢æ¿ | é€‰æ‹© cc-spec å·¥ä½œæµ |
| å…¶ä»– | è‡ªç„¶è¯­è¨€ | "å¸®æˆ‘æ‰§è¡Œ cc-spec specify" |
