# 05 - 任务拆分

## 任务总览

| Wave | Task-ID | 预估 | 状态 | 依赖 | 说明 |
|------|---------|------|------|------|------|
| 0 | 20-ID-MANAGER | 35k | 🟩 完成 | - | ID 管理模块 |
| 1 | 21-CMD-LIST | 30k | 🟩 完成 | 20 | list 命令 |
| 1 | 22-CMD-GOTO | 25k | 🟩 完成 | 20 | goto 命令 |
| 1 | 23-CMD-UPDATE | 35k | 🟩 完成 | 20 | update 命令 |
| 2 | 24-CMD-SPECIFY-ID | 20k | 🟩 完成 | 20 | specify 支持 ID |
| 2 | 25-CMD-CLARIFY-ID | 20k | 🟩 完成 | 20 | clarify 支持 ID |
| 2 | 26-CMD-PLAN-ID | 20k | 🟩 完成 | 20 | plan 支持 ID |
| 2 | 27-CMD-APPLY-ID | 25k | 🟩 完成 | 20,29 | apply 支持 ID + Profile |
| 2 | 28-CMD-OTHERS-ID | 25k | 🟩 完成 | 20 | checklist/archive 支持 ID |
| 3 | 29-SUBAGENT-PROFILE | 35k | 🟩 完成 | - | Subagent 公共配置 |
| 4 | 30-CMD-GENERATOR | 40k | 🟩 完成 | 23 | 斜杠命令生成器 (9/17 工具) |
| 4 | 31-CMD-TEMPLATES | 30k | 🟩 完成 | 30 | 命令模板（9 工具已实现） |
| 5 | 32-INTEGRATION | 30k | 🟩 完成 | ALL | 集成测试 |
| 5 | 33-DOCS | 25k | 🟨 部分完成 | ALL | 文档更新 (待 v1.2 补充) |

**总预估**: ~395k tokens

---

## 任务详情

### Task: 20-ID-MANAGER
**预估上下文**: ~35k tokens
**状态**: 🟩 完成
**依赖**: 无
**Wave**: 0
**完成说明**: ID 管理模块已实现于 `src/cc_spec/core/id_manager.py`

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (ID 管理机制部分)
- src/cc_spec/core/state.py (现有状态管理参考)

**核心代码入口**:
- (新建) src/cc_spec/core/id_manager.py

**Checklist**:
- [ ] 定义 IDType 枚举 (CHANGE/TASK/SPEC/ARCHIVE)
- [ ] 定义 ParsedID dataclass
- [ ] 实现 IDManager 类
- [ ] 实现 generate_change_id() 生成新 ID
- [ ] 实现 parse_id() 解析 ID 字符串
- [ ] 实现 resolve_path() 根据 ID 解析路径
- [ ] 实现 register_change() 注册新变更
- [ ] 实现 _load_id_map() 和 _save_id_map()
- [ ] 创建 id-map.yaml 模板
- [ ] 编写单元测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 21-CMD-LIST
**预估上下文**: ~30k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 1
**完成说明**: list 命令已实现于 `src/cc_spec/commands/list.py`

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (list 命令设计)
- src/cc_spec/ui/display.py (表格显示参考)

**核心代码入口**:
- (新建) src/cc_spec/commands/list.py
- (修改) src/cc_spec/__init__.py

**Checklist**:
- [ ] 实现 list_command() 主函数
- [ ] 实现 list_changes() 列出变更
- [ ] 实现 list_tasks() 列出任务
- [ ] 实现 list_specs() 列出规格
- [ ] 实现 list_archive() 列出归档
- [ ] 支持 --status 过滤
- [ ] 支持 --format table/json/simple
- [ ] 注册命令到 app
- [ ] 编写集成测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 22-CMD-GOTO
**预估上下文**: ~25k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 1
**完成说明**: goto 命令已实现于 `src/cc_spec/commands/goto.py`

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (goto 命令设计)
- src/cc_spec/core/state.py (状态管理)

**核心代码入口**:
- (新建) src/cc_spec/commands/goto.py
- (修改) src/cc_spec/__init__.py

**Checklist**:
- [ ] 实现 goto_command() 主函数
- [ ] 实现 goto_change() 跳转到变更
- [ ] 实现 goto_task() 跳转到任务
- [ ] 根据状态显示不同的操作选项
- [ ] 支持 --force 强制跳转
- [ ] 实现交互式菜单
- [ ] 注册命令到 app
- [ ] 编写集成测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 23-CMD-UPDATE
**预估上下文**: ~35k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 1
**完成说明**: update 命令已实现于 `src/cc_spec/commands/update.py`

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (update 命令设计)
- src/cc_spec/core/config.py (配置管理)

**核心代码入口**:
- (新建) src/cc_spec/commands/update.py
- (修改) src/cc_spec/__init__.py

**Checklist**:
- [ ] 实现 update_command() 主函数
- [ ] 实现 add_agents() 添加 AI 工具
- [ ] 实现 update_templates() 更新模板
- [ ] 实现 update_slash_commands() 更新斜杠命令
- [ ] 实现 update_subagent_config() 更新 Subagent 配置
- [ ] 支持托管标记块更新机制
- [ ] 支持 --force 强制覆盖
- [ ] 注册命令到 app
- [ ] 编写集成测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 24-CMD-SPECIFY-ID
**预估上下文**: ~20k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 2
**完成说明**: specify 命令已支持 ID 参数

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (现有命令改造)
- src/cc_spec/commands/specify.py

**核心代码入口**:
- (修改) src/cc_spec/commands/specify.py

**Checklist**:
- [ ] 修改参数 name → name_or_id
- [ ] 添加 ID 检测逻辑
- [ ] 实现 edit_existing_change() 编辑现有变更
- [ ] 在创建时调用 id_manager.register_change()
- [ ] 保持向后兼容（名称参数仍可用）
- [ ] 更新帮助文本
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 25-CMD-CLARIFY-ID
**预估上下文**: ~20k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 2
**完成说明**: clarify 命令已支持 ID 参数

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md
- src/cc_spec/commands/clarify.py

**核心代码入口**:
- (修改) src/cc_spec/commands/clarify.py

**Checklist**:
- [ ] 修改参数支持 ID 格式
- [ ] 支持 C-xxx 变更 ID
- [ ] 支持 C-xxx:task-id 任务 ID
- [ ] 保持向后兼容
- [ ] 更新帮助文本
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 26-CMD-PLAN-ID
**预估上下文**: ~20k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 2
**完成说明**: plan 命令已支持 ID 参数

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md
- src/cc_spec/commands/plan.py

**核心代码入口**:
- (修改) src/cc_spec/commands/plan.py

**Checklist**:
- [ ] 修改参数支持 ID 格式
- [ ] 添加 ID 解析逻辑
- [ ] 保持向后兼容
- [ ] 更新帮助文本
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 27-CMD-APPLY-ID
**预估上下文**: ~25k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER, 29-SUBAGENT-PROFILE
**Wave**: 2
**完成说明**: apply 命令已支持 ID + Profile 集成

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md
- src/cc_spec/commands/apply.py
- src/cc_spec/subagent/executor.py

**核心代码入口**:
- (修改) src/cc_spec/commands/apply.py
- (修改) src/cc_spec/subagent/executor.py

**Checklist**:
- [ ] 修改参数支持 ID 格式
- [ ] 添加 ID 解析逻辑
- [ ] 集成 Profile 配置使用
- [ ] 保持向后兼容
- [ ] 更新帮助文本
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 28-CMD-OTHERS-ID
**预估上下文**: ~25k tokens
**状态**: 🟩 完成
**依赖**: 20-ID-MANAGER
**Wave**: 2
**完成说明**: checklist/archive 命令已支持 ID 参数

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md
- src/cc_spec/commands/checklist.py
- src/cc_spec/commands/archive.py

**核心代码入口**:
- (修改) src/cc_spec/commands/checklist.py
- (修改) src/cc_spec/commands/archive.py

**Checklist**:
- [ ] 修改 checklist 参数支持 ID
- [ ] 修改 archive 参数支持 ID
- [ ] 添加 ID 解析逻辑
- [ ] 保持向后兼容
- [ ] 更新帮助文本
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 29-SUBAGENT-PROFILE
**预估上下文**: ~35k tokens
**状态**: 🟩 完成
**依赖**: 无
**Wave**: 3
**完成说明**: SubAgentProfile 已实现于 `src/cc_spec/core/config.py`，支持 common/profiles 配置

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (Subagent 公共配置)
- src/cc_spec/core/config.py
- src/cc_spec/subagent/task_parser.py

**核心代码入口**:
- (修改) src/cc_spec/core/config.py
- (修改) src/cc_spec/subagent/task_parser.py
- (修改) src/cc_spec/subagent/executor.py

**Checklist**:
- [ ] 定义 SubAgentProfile dataclass
- [ ] 扩展 SubAgentConfig 支持 common/profiles
- [ ] 实现 get_profile() 方法（继承合并）
- [ ] 修改 task_parser 解析 Profile 字段
- [ ] 修改 executor 使用 Profile 配置
- [ ] 更新 config.yaml 格式
- [ ] 编写单元测试
- [ ] 编写集成测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 30-CMD-GENERATOR
**预估上下文**: ~40k tokens
**状态**: 🟩 完成
**依赖**: 23-CMD-UPDATE
**Wave**: 4
**完成说明**: 命令生成器已实现于 `src/cc_spec/core/command_generator.py`，支持 9 个 AI 工具

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (斜杠命令生成)
- reference/spec-kit/src/specify_cli/__init__.py (AGENT_CONFIG 参考)

**核心代码入口**:
- (新建) src/cc_spec/core/command_generator.py

**Checklist**:
- [ ] 定义 CommandGenerator 抽象基类
- [ ] 实现 ClaudeCommandGenerator
- [ ] 实现 CursorCommandGenerator
- [ ] 实现 GeminiCommandGenerator
- [ ] 实现 CopilotCommandGenerator
- [ ] 实现 AmazonQCommandGenerator
- [ ] 实现 WindsurfCommandGenerator
- [ ] 实现其他工具生成器
- [ ] 创建 COMMAND_GENERATORS 注册表
- [ ] 实现托管标记块更新机制
- [ ] 编写单元测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 31-CMD-TEMPLATES
**预估上下文**: ~30k tokens
**状态**: 🟩 完成
**依赖**: 30-CMD-GENERATOR
**Wave**: 4
**完成说明**: 命令模板已实现，支持 9 个工具 (Claude, Cursor, Gemini, Copilot, AmazonQ, Windsurf, Qwen, Codeium, Continue)

**必读文档**:
- docs/plan/cc-spec-v1.1/03-设计方案.md (命令模板示例)
- reference/spec-kit/templates/commands/

**核心代码入口**:
- (新建) src/cc_spec/templates/commands/*.md.j2
- (新建) src/cc_spec/templates/commands/*.toml.j2

**Checklist**:
- [ ] 创建 list.md.j2 模板
- [ ] 创建 goto.md.j2 模板
- [ ] 创建 update.md.j2 模板
- [ ] 更新 specify.md.j2 模板
- [ ] 更新 clarify.md.j2 模板
- [ ] 更新 plan.md.j2 模板
- [ ] 更新 apply.md.j2 模板
- [ ] 更新 checklist.md.j2 模板
- [ ] 更新 archive.md.j2 模板
- [ ] 创建 TOML 格式模板
- [ ] 集成到 init 和 update 命令
- [ ] 编写测试

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 32-INTEGRATION
**预估上下文**: ~30k tokens
**状态**: 🟩 完成
**依赖**: ALL (20-31)
**Wave**: 5
**完成说明**: v1.1 集成测试已完成

**必读文档**:
- docs/plan/cc-spec-v1.1/01-背景与目标.md (成功指标)
- tests/ (现有测试参考)

**核心代码入口**:
- (新建) tests/integration/test_v11_workflow.py
- (新建) tests/integration/test_id_workflow.py
- (新建) tests/integration/test_profile_workflow.py

**Checklist**:
- [ ] 编写 ID 工作流测试 (创建 → 列表 → 跳转)
- [ ] 编写 update 工作流测试
- [ ] 编写 Profile 工作流测试
- [ ] 编写斜杠命令生成测试
- [ ] 验证所有 11 个命令可用
- [ ] 验证向后兼容性
- [ ] 测试覆盖率 > 80%

**执行日志**:
_(SubAgent 执行时填写)_

---

### Task: 33-DOCS
**预估上下文**: ~25k tokens
**状态**: 🟨 部分完成
**依赖**: ALL (20-31)
**Wave**: 5
**完成说明**: 部分文档已更新，剩余内容将在 v1.2 中补充完成

**必读文档**:
- docs/plan/cc-spec-v1.1/*.md
- README.md

**核心代码入口**:
- (修改) README.md
- (修改) docs/plan/cc-spec-v1.1/README.md
- (新建) docs/upgrade-v1.1.md

**Checklist**:
- [ ] 更新 README.md 命令说明
- [ ] 更新 v1.1 文档状态为完成
- [ ] 创建升级指南
- [ ] 更新命令帮助文本
- [ ] 检查文档准确性

**执行日志**:
_(SubAgent 执行时填写)_

---

## Wave 执行计划

```
Wave 0 (1 任务):
└── 20-ID-MANAGER

Wave 1 (3 任务, 可并发):
├── 21-CMD-LIST
├── 22-CMD-GOTO
└── 23-CMD-UPDATE

Wave 2 (5 任务, 可并发):
├── 24-CMD-SPECIFY-ID
├── 25-CMD-CLARIFY-ID
├── 26-CMD-PLAN-ID
├── 27-CMD-APPLY-ID (依赖 29)
└── 28-CMD-OTHERS-ID

Wave 3 (1 任务):
└── 29-SUBAGENT-PROFILE

Wave 4 (2 任务, 串行):
├── 30-CMD-GENERATOR
└── 31-CMD-TEMPLATES (依赖 30)

Wave 5 (2 任务, 可并发):
├── 32-INTEGRATION
└── 33-DOCS
```

---

## 并发优化

| Wave | 任务数 | 并发数 | 预计节省 |
|------|--------|--------|----------|
| 1 | 3 | 3 | ~60k tokens |
| 2 | 5 | 4 | ~70k tokens |
| 5 | 2 | 2 | ~30k tokens |

**总节省**: ~160k tokens (约 40%)

---

## 与 v1.0 任务的关系

v1.1 任务编号从 20 开始，延续 v1.0 的编号：

```
v1.0 任务: 01-19 (已完成)
v1.1 任务: 20-33 (本次)
```

v1.1 可与 v1.0 剩余任务（如有）并行开发，互不依赖。

---

*基于 v1.1 设计方案和实施步骤编写*
